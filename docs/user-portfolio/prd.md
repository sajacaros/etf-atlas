# 포트폴리오 비중 관리 서비스 PRD

## 1. 목적

사용자가 **여러 포트폴리오를 관리**하면서

* 목표 비중(설계)
* 실제 보유(현실)
  을 비교하고,
  **현재가 기준으로 매수·매도 필요 수량을 자동 계산**할 수 있는 서비스.

핵심 철학:

> 설계는 계속 바뀌고, 실제 보유는 누적된다.

---

## 2. 핵심 개념

### 2.1 이중 데이터 구조

* **목표 설계(Target)**: 사용자가 주기적·이벤트성으로 수정
* **실제 보유(Holding)**: 실제 매수 수량의 누적


두 데이터는 분리 저장되며, 항상 함께 비교된다.

### 2.2 특수 종목 처리
* **CASH (현금)**:
  * 티커처럼 취급하되, **현재가(Current Price)는 항상 1원으로 고정**.
  * 외부 시세 연동(yfinance) 불필요.
  * 사용자가 직접 수량(금액) 입력.

---

## 3. 계산 기준 (중요)

포트폴리오 단위로 기준 선택:

* `TARGET_AMOUNT` : 입력한 목표금액 기준 (설계/시뮬레이션)
* `CURRENT_TOTAL` : 실제 보유 총액 기준 (운영 기본값)

실제 매수가 존재하면 기본값은 `CURRENT_TOTAL`.

---

## 4. 화면 / UX 원칙

* 상단·하단 고정 분리 ❌
* **종목 단위 단일 테이블** 구성 ✅
* 목표/실제를 나란히 비교
* 목표 비중은 인라인 수정 가능
* **유효성 검사**: 목표 비중 합계가 100%가 아니면 **경고(Warning)** 표시 (저장은 허용)

### 표시 규칙

* **목표 또는 실제 중 하나라도 존재하면 반드시 표시**

---

## 5. 설계 변경 규칙 (핵심 로직)

### 5.1 설계에서 종목 삭제

* 실제 보유가 있으면 계속 표시
* 목표 수량 = 0
* 구매 필요 수량 = `-실제 수량`
* 상태: 매도 대상

### 5.2 설계에 종목 신규 추가

* 실제 수량 = 0
* 목표 수량 > 0
* 구매 필요 수량 = `+목표 수량`
* 상태: 신규 매수 대상

---

## 6. 계산 로직

* 목표금액 = 기준금액 × 목표비중
* 목표수량 = 목표금액 ÷ 현재가
* 실제평가금액 = 실제수량 × 현재가
* 구매 필요 수량 = 목표수량 − 실제수량
* 가감금액 = 구매 필요 수량 × 현재가

---

## 7. 데이터 모델 (요약)

### Portfolio

* id, user_id, name
* calculation_base (TARGET_AMOUNT | CURRENT_TOTAL)
* target_total_amount (nullable)

### TargetAllocation

* portfolio_id, ticker, target_weight

### Holding

* portfolio_id, ticker, quantity

---

## 8. MVP 범위

* **대상 자산**: 국내 상장 ETF (KRW 전용) - 환율 처리 불필요
* 단일 사용자
* 포트폴리오 다중 관리
* 목표 비중 설정 및 수정
* 실제 수량 입력
* 현재가 기반 매수/매도 필요 수량 계산

---

## 9. 비목표

* 자동 매매
* 투자 추천 판단
* 설계 변경 히스토리 관리

---
## 10. 참고
* 현재 엑셀에서 관리되고 있는 화면
* ![](excel.png)

